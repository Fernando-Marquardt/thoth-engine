<link rel="stylesheet" href="/views/assets/staff.css">
<form action="staff_roles.php?action=revoke" method="post" class="form-roles">
    <div class="form-group">
        <label for="user">User</label>
        <select name="user" id="user" class="form-control" required>
            <option value="0" disabled selected>-- SELECT --</option>
            {{USER-MENU}}
        </select>
    </div>
    <div class="form-group">
        <label for="role">Role</label>
        <select name="role" id="role" class="form-control" required>
            <option value="0" disabled selected>-- SELECT --</option>
            {{ROLE-MENU}}
        </select>
    </div>
    <div class="form-group">
        <button type="submit" name="submit" class="btn">
            Revoke
        </button>
    </div>
</form>

<script>
    const updateRoleMenu = (ev, roleElem) => {
        const userId = parseInt(ev.currentTarget.value) ?? 0;
        if (userId < -1) {
            console.error('Invalid userId');
            return false;
        }
        fetch(`/staff_api.php?get=user-roles&id=${userId}`)
            .then(response => response.json())
            .then(response => {
                if (response.type !== "success") {
                    console.error(response.message);
                    return false;
                }
                let roleMarkup = `<option value="0" disabled selected>-- SELECT --</option>`;
                for (const role of response.data) {
                    roleMarkup += `<option value="${role.id}">${role.name}</option>`;
                }
                roleElem.innerHTML = roleMarkup;
                console.log(response);
            })
            .catch(err => console.error(err));
    };
    document.addEventListener("DOMContentLoaded", () => {
        const userElem = document.getElementById("user");
        const roleElem = document.getElementById("role");
        userElem.addEventListener("change", ev => {
            updateRoleMenu(ev, roleElem);
        });
    });
</script>
